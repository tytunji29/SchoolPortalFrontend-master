import{a as oe,b as re,c as ae}from"./chunk-5GULS5GK.js";import{a as se}from"./chunk-KEQMXZG3.js";import"./chunk-GOXB5OSV.js";import{a as N}from"./chunk-4BHWRWDA.js";import{a as F}from"./chunk-ZP7S6SWW.js";import{b as z,c as J,d as Q,g as X,j as Z,k as ee,t as te,v as ie,w as ne}from"./chunk-EAGDHIOY.js";import{aa as $,ba as O,bb as R,cb as G,d as D,e as A,qb as q,ra as W,sa as L,sb as K,tb as U,ub as H,va as P,vb as Y}from"./chunk-ZE63MCPL.js";import{$b as E,Kb as n,Lb as o,Qb as C,Vb as d,Xb as p,db as c,eb as I,hc as a,ia as B,ic as y,mc as h,nc as x,oc as T,qc as k,sc as j,ta as _,tc as v,ua as b,vc as w,xb as S,zb as f}from"./chunk-DRLFSV2D.js";import{a as M,f as ce}from"./chunk-TMEVGU2Q.js";var m=ce(se());var le=l=>({itemsPerPage:4,currentPage:l});function de(l,u){if(l&1){let r=C();n(0,"button",15),d("click",function(){_(r);let t=p();return b(t.openModal())}),a(1,"Add"),o()}}function me(l,u){if(l&1){let r=C();n(0,"tr")(1,"th",21),a(2),o(),n(3,"td"),a(4),o(),n(5,"td")(6,"button",22),d("click",function(){let t=_(r).$implicit,e=p(2);return b(e.viewCountry(t))}),n(7,"i",23),a(8,"view"),o()(),n(9,"button",24),d("click",function(){let t=_(r).$implicit,e=p(2);return b(e.editCountry(t))}),n(10,"i",25),a(11,"edit"),o()(),n(12,"button",26),d("click",function(){let t=_(r).$implicit,e=p(2);return b(e.deleteCountry(t))}),n(13,"i",27),a(14,"delete"),o()()()()}if(l&2){let r=u.$implicit,i=u.index;c(2),y(i+1),c(2),y(r.name)}}function ue(l,u){if(l&1){let r=C();n(0,"c-card-body")(1,"input",16),T("ngModelChange",function(t){_(r);let e=p();return x(e.searchText,t)||(e.searchText=t),b(t)}),o(),n(2,"table",17)(3,"thead")(4,"tr")(5,"th",18),a(6,"SN"),o(),n(7,"th",18),a(8,"Subject Name"),o(),n(9,"th",18),a(10,"Actions"),o()()(),n(11,"tbody"),S(12,me,15,2,"tr",19),v(13,"search"),v(14,"paginate"),o()(),n(15,"pagination-controls",20),d("pageChange",function(t){_(r);let e=p();return b(e.p=t)}),o()()}if(l&2){let r=p();c(),h("ngModel",r.searchText),c(11),f("ngForOf",w(14,5,w(13,2,r.conList,r.searchText),j(8,le,r.p)))}}function pe(l,u){if(l&1){let r=C();n(0,"tr")(1,"th",21),a(2),o(),n(3,"td"),a(4),o(),n(5,"td"),a(6),o(),n(7,"td")(8,"button",22),d("click",function(){let t=_(r).$implicit,e=p(2);return b(e.generateMyTimetable(t))}),n(9,"i",23),a(10,"Schedule My Timetable"),o()()()()}if(l&2){let r=u.$implicit,i=u.index;c(2),y(i+1),c(2),y(r.subject),c(2),y(r.className)}}function _e(l,u){if(l&1){let r=C();n(0,"c-card-body")(1,"input",16),T("ngModelChange",function(t){_(r);let e=p();return x(e.searchText,t)||(e.searchText=t),b(t)}),o(),n(2,"table",17)(3,"thead")(4,"tr")(5,"th",18),a(6,"SN"),o(),n(7,"th",18),a(8,"Subject Name"),o(),n(9,"th",18),a(10,"Class Name"),o(),n(11,"th",18),a(12,"Actions"),o()()(),n(13,"tbody"),S(14,pe,11,3,"tr",19),v(15,"search"),v(16,"paginate"),o()(),n(17,"pagination-controls",20),d("pageChange",function(t){_(r);let e=p();return b(e.p=t)}),o()()}if(l&2){let r=p();c(),h("ngModel",r.searchText),c(13),f("ngForOf",w(16,5,w(15,2,r.conList,r.searchText),j(8,le,r.p)))}}function be(l,u){if(l&1){let r=C();n(0,"div",12)(1,"label"),a(2),o(),n(3,"div",28)(4,"input",29),T("ngModelChange",function(t){let e=_(r).$implicit,s=p();return x(s.timetable[e].startTime,t)||(s.timetable[e].startTime=t),b(t)}),o(),n(5,"input",30),T("ngModelChange",function(t){let e=_(r).$implicit,s=p();return x(s.timetable[e].endTime,t)||(s.timetable[e].endTime=t),b(t)}),o()()()}if(l&2){let r=u.$implicit,i=p();c(2),y(r),c(2),E("name","",r,"StartTime"),h("ngModel",i.timetable[r].startTime),c(),E("name","",r,"EndTime"),h("ngModel",i.timetable[r].endTime)}}var $e=(()=>{let u=class u{constructor(i){this.apiService=i,this.conList=[],this.searchText="",this.p=1,this.isModalVisible=!1,this.canSeeAddButton=!0,this.isEditMode=!1,this.currentCountry={name:"",className:"",subject:"",subjectId:"",classId:"",Id:""},this.isTimetableModalVisible=!1,this.weekdays=["Monday","Tuesday","Wednesday","Thursday","Friday"],this.timetable={},this.weekdays.forEach(t=>{this.timetable[t]={startTime:"",endTime:""}})}refreshData(){let i="Subject/GetAll",t=localStorage.getItem("role");t&&t!=="Admin"&&(i="Subject/GetAllForTeacher"),this.apiService.get(i).subscribe({next:e=>{console.log(`I reach here ${e}`),console.log(e),e.status==="success"?this.conList=e.data:m.default.fire({title:"Error",text:`${e.message}`,icon:"error",confirmButtonText:"Retry"})},error:e=>{m.default.fire({title:"Error",text:`${e.error.message}`,icon:"error",confirmButtonText:"Retry"})}})}ngOnInit(){var i=localStorage.getItem("role");i!="Admin"&&(this.canSeeAddButton=!1),this.refreshData()}openTimetableModal(i){this.isTimetableModalVisible=!0}closeTimetableModal(){this.isTimetableModalVisible=!1}saveTimetable(){let i={classId:this.currentCountry.classId,timetable:this.timetable,subjectId:this.currentCountry.subjectId};console.log("Timetable saved:",i),this.apiService.post("Subject/GenerateMyTimetable",i).subscribe({next:t=>{console.log("Subject added successful",t),t.status==="success"?m.default.fire({title:"Success!",text:`${t.message}`,icon:"success",confirmButtonText:"OK"}).then(()=>{this.closeModal(),this.ngOnInit()}):m.default.fire({title:"Error",text:`${t.message}`,icon:"error",confirmButtonText:"Retry"})},error:t=>{m.default.fire({title:"Error",text:`${t.error.message}`,icon:"error",confirmButtonText:"Retry"})}}),this.closeTimetableModal()}getWeekdayDate(i){let t=new Date,e=t.getDay(),g=(this.weekdays.indexOf(i)+1-e+7)%7,V=new Date(t);return V.setDate(t.getDate()+g),V.toISOString().split("T")[0]}generateMyTimetable(i){this.currentCountry=M({},i),this.openTimetableModal(i)}saveCountry(){console.log("Save country:",this.currentCountry),this.isEditMode=!1,this.apiService.post("Subject/Add",this.currentCountry).subscribe({next:i=>{console.log("Subject added successful",i),i.status==="success"?m.default.fire({title:"Success!",text:`${i.message}`,icon:"success",confirmButtonText:"OK"}).then(()=>{this.closeModal(),this.ngOnInit()}):m.default.fire({title:"Error",text:`${i.message}`,icon:"error",confirmButtonText:"Retry"})},error:i=>{m.default.fire({title:"Error",text:`${i.error.message}`,icon:"error",confirmButtonText:"Retry"})}})}updateCountry(){let i={name:this.currentCountry.name};this.apiService.put(`Subject/UpdateById/${this.currentCountry.id}`,i).subscribe({next:t=>{if(t.status==="success"){let e=this.conList.findIndex(s=>s.id===this.currentCountry.id);e!==-1&&(this.conList[e]=M({},this.currentCountry)),m.default.fire({title:"Updated!",text:`${t.message}`,icon:"success",confirmButtonText:"OK"}).then(()=>{this.closeModal(),this.ngOnInit()})}else m.default.fire({title:"Error",text:`${t.message}`,icon:"error",confirmButtonText:"Retry"})},error:t=>{m.default.fire({title:"Error",text:`${t.error.message||"An unexpected error occurred"}`,icon:"error",confirmButtonText:"Retry"})}})}viewCountry(i){let e=new Date(i.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"});m.default.fire({title:"Country Details",html:`<strong>Country:</strong> ${i.name}
      <br/>
             <strong>CreatedAt:</strong> ${e} `,icon:"info",confirmButtonText:"Close"})}editCountry(i){console.log("Edit country:",i),this.currentCountry=M({},i),this.isEditMode=!0,this.openModal()}saveTimetableEdit(i){console.log("Edit country:",i),this.currentCountry=M({},i),this.openModal()}deleteCountry(i){m.default.fire({title:"Are you sure?",text:`Do you want to delete ${i.name}?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, keep it"}).then(t=>{t.isConfirmed?this.apiService.delete(`Subject/DeleteById/${i.id}`).subscribe({next:()=>{this.conList=this.conList.filter(e=>e.id!==i.id),m.default.fire("Deleted!",`${i.name} has been deleted.`,"success"),this.ngOnInit()},error:e=>{m.default.fire({title:"Error",text:`${e.error.message}`,icon:"error",confirmButtonText:"Retry"})}}):t.dismiss===m.default.DismissReason.cancel&&m.default.fire("Cancelled",`${i.name} is safe.`,"error")})}openModal(){console.log("Opening modal"),this.isModalVisible=!0}closeModal(){this.isModalVisible=!1}};u.\u0275fac=function(t){return new(t||u)(I(F))},u.\u0275cmp=B({type:u,selectors:[["app-classlevel"]],standalone:!0,features:[k],decls:38,vars:9,consts:[["xs","12"],[1,"mb-4"],[1,"d-flex","justify-content-between","align-items-center"],["class","btn btn-primary ml-auto",3,"click",4,"ngIf"],[4,"ngIf"],["backdrop","static",3,"visibleChange","visible"],["cModalTitle",""],["cButtonClose","",3,"click"],[3,"ngSubmit"],["class","form-group",4,"ngFor","ngForOf"],["cButton","","color","secondary",3,"click"],["cButton","","color","primary",3,"click"],[1,"form-group"],["for","countryName"],["type","text","id","countryName","name","name","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","ml-auto",3,"click"],["type","text","placeholder","Search subject",1,"form-control","mb-3",3,"ngModelChange","ngModel"],["cTable","",1,"table","table-striped"],["scope","col"],[4,"ngFor","ngForOf"],[3,"pageChange"],["scope","row"],[1,"btn","btn-sm","btn-info",3,"click"],[1,"fa","fa-eye"],[1,"btn","btn-sm","btn-warning",3,"click"],[1,"fa","fa-pencil"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"fa","fa-times"],[1,"d-flex","align-items-center"],["type","time","required","",1,"form-control","mr-2",3,"ngModelChange","ngModel","name"],["type","time","required","",1,"form-control",3,"ngModelChange","ngModel","name"]],template:function(t,e){t&1&&(n(0,"c-row")(1,"c-col",0)(2,"c-card",1)(3,"c-card-header",2)(4,"strong"),a(5,"Subjects List"),o(),S(6,de,2,0,"button",3),o(),S(7,ue,16,10,"c-card-body",4)(8,_e,18,10,"c-card-body",4),o()()(),n(9,"c-modal",5),d("visibleChange",function(g){return e.isTimetableModalVisible=g}),n(10,"c-modal-header")(11,"h5",6),a(12,"Schedule Timetable"),o(),n(13,"button",7),d("click",function(){return e.closeTimetableModal()}),o()(),n(14,"c-modal-body")(15,"form",8),d("ngSubmit",function(){return e.saveTimetable()}),S(16,be,6,7,"div",9),o()(),n(17,"c-modal-footer")(18,"button",10),d("click",function(){return e.closeTimetableModal()}),a(19,"Close"),o(),n(20,"button",11),d("click",function(){return e.saveTimetable()}),a(21,"Save"),o()()(),n(22,"c-modal",5),d("visibleChange",function(g){return e.isModalVisible=g}),n(23,"c-modal-header")(24,"h5",6),a(25),o(),n(26,"button",7),d("click",function(){return e.closeModal()}),o()(),n(27,"c-modal-body")(28,"form",8),d("ngSubmit",function(){return e.isEditMode?e.updateCountry():e.saveCountry()}),n(29,"div",12)(30,"label",13),a(31,"Subject"),o(),n(32,"input",14),T("ngModelChange",function(g){return x(e.currentCountry.name,g)||(e.currentCountry.name=g),g}),o()()()(),n(33,"c-modal-footer")(34,"button",10),d("click",function(){return e.closeModal()}),a(35,"Close"),o(),n(36,"button",11),d("click",function(){return e.isEditMode?e.updateCountry():e.saveCountry()}),a(37),o()()()),t&2&&(c(6),f("ngIf",e.canSeeAddButton),c(),f("ngIf",e.canSeeAddButton),c(),f("ngIf",!e.canSeeAddButton),c(),f("visible",e.isTimetableModalVisible),c(7),f("ngForOf",e.weekdays),c(6),f("visible",e.isModalVisible),c(3),y(e.isEditMode?"Edit Subject":"Add Subject"),c(7),h("ngModel",e.currentCountry.name),c(5),y(e.isEditMode?"Update":"Save"))},dependencies:[G,R,W,P,L,ne,ee,z,J,Q,te,ie,Z,X,$,D,A,ae,re,oe,N,Y,U,H,q,K,O]});let l=u;return l})();export{$e as SubjectsComponent};
